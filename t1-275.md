# Documentação da Branch: t1-275

## Objetivo
Refatorar o componente `AnaliseIA` do Gráfico de Piezômetro para seguir os princípios de Código Limpo, Responsabilidade Única (SRP) e padronização de nomenclatura em português, conforme definido no arquivo `ia.md`.

## Alterações Realizadas

### 1. Novo Hook Customizado
- **Arquivo**: `hooks/useAnaliseIATelaRelNivelEstatico.ts`
- **Descrição**: Extraída toda a lógica de estado (edição) e de negócio (avaliação via SweetAlert) que antes residia dentro do componente visual.
- **Nomenclatura**: Todas as funções e variáveis internas foram escritas em português (ex: `estaEditando`, `aoAvaliar`, `aoSalvarEdicao`).

### 2. Refatoração do Componente Visual
- **Arquivo**: `components/GraficoPiezometro/AnaliseIA.tsx`
- **Descrição**: O componente agora é focado exclusivamente na renderização da interface. Ele consome a lógica através do novo hook.
- **Nomenclatura**: Propriedades e variáveis internas atualizadas para português (ex: `AnaliseIAProps` -> `AnaliseIAPropriedades`, `onSave` -> `aoSalvar`).

### 3. Atualização do Consumidor
- **Arquivo**: `components/GraficoPiezometro/index.tsx`
- **Descrição**: Atualizada a chamada do componente `AnaliseIA` e `BarraFiltros` para refletir os novos nomes das propriedades.

----------------------------------------------

### 4. Refatoração da Barra de Filtros
- **Arquivo**: `components/GraficoPiezometro/BarraFiltros.tsx` (Antigo `FilterBar.tsx`)
- **Descrição**: O componente foi renomeado e refatorado para usar apenas português e tipos explícitos, eliminando o uso de `any`.
- **Decisão Técnica**: Seguindo os princípios **KISS** e **YAGNI**, optou-se por NÃO criar um hook para este componente, já que ele não possui lógica de estado interna complexa, mantendo a simplicidade.

----------------------------------------------

### 5. Extração da Tabela de Dados
- **Arquivo**: `components/GraficoPiezometro/TabelaDadosPiezometro.tsx`
- **Descrição**: Extraída toda a lógica de renderização da tabela de resultados, que antes ocupava mais de 100 linhas no `index.tsx`.
- **Nomenclatura**: Padronizada em português e com tipos bem definidos.
- **Benefício**: Redução drástica da "sujeira" visual no componente principal e melhor isolamento da lógica de colunas por tipo de piezômetro.

----------------------------------------------

### 6. Hook de Exportação de Relatórios
- **Arquivo**: `hooks/useExportacaoRelatorioTelaNivelEstatico.ts`
- **Descrição**: Criado um hook especializado para lidar com a geração de PDF e Word. 
- **Decisão Técnica**: Moveu-se toda a manipulação direta de DOM (`document.createElement`, `cloneNode`) e chamadas de bibliotecas externas para fora do componente visual.
- **Benefício**: O componente `index.tsx` agora apenas chama o hook, sem precisar saber como os arquivos são gerados internamente.

----------------------------------------------

### 7. Isolamento do Componente de Gráfico
- **Arquivo**: `components/GraficoPiezometro/GraficoTelaNivelEstatico.tsx`
- **Descrição**: O gráfico e sua lógica de legendas customizadas foram isolados em um componente próprio.
- **Decisão Técnica**: Utilizou-se `forwardRef` para que o componente pai ainda consiga acessar o gráfico para exportação, mas sem precisar gerenciar o estado interno das legendas.
- **Benefício**: O componente `index.tsx` tornou-se um puro orquestrador de layout, com zero lógica de manipulação visual direta de gráficos.

----------------------------------------------

### 8. Limpeza da Página de Dashboard (Home)
- **Arquivo**: `app/(main)/page.tsx`
- **Descrição**: Remoção de códigos de demonstração e agora atua renderizando a página de relatório de nível estático para manter consistência.

----------------------------------------------

### 9. Reestruturação de Rotas e Páginas
- **Novo Arquivo**: `app/(main)/pages/relatorio-nivel-estatico/page.tsx`
- **Descrição**: Criada uma página dedicada para o relatório de nível estático, seguindo o padrão da rota `qualidade-agua`.
- **Alteração de Menu**: O atalho no `layout/AppMenu.tsx` foi atualizado de `/` para `/pages/relatorio-nivel-estatico`.
- **Benefício**: Melhor organização do sistema de arquivos e separação clara entre a "Home" e a funcionalidade específica de relatórios.

----------------------------------------------

### 10. Refatoração da AnaliseIA (Qualidade da Água)
- **Arquivo**: `components/QualidadeAgua/AnaliseIA.tsx`
- **Novo Hook**: `hooks/useAnaliseIATelaQualidadeAgua.ts`
- **Descrição**: Seguindo o mesmo modelo do Nível Estático, extraímos a lógica de avaliação e edição para um hook customizado.
- **Nomenclatura**: Padronização completa em português e remoção de lógica de negócio de dentro do componente visual.

----------------------------------------------

### 11. Refatoração da Barra de Filtros (Qualidade da Água)
- **Novo Arquivo**: `components/QualidadeAgua/BarraFiltros.tsx` (Substituiu o `FilterBar.tsx`).
- **Novo Hook**: `hooks/useBarraFiltrosQualidadeAgua.ts`.
- **Descrição**: Centralização da lógica de seleção de parâmetros (checkboxes) e visibilidade de filtros extras.
- **Nomenclatura e Tipagem**: Nomes traduzidos para português e uso de interfaces rigorosas para substituir `any[]`.
- **Decisão Técnica**: Mantido o comportamento de `appendTo="self"` conforme solicitado, garantindo que a funcionalidade visual permaneça idêntica, mas com código superior.

----------------------------------------------

### 12. Refatoração dos Gráficos de Análise (Qualidade da Água)
- **Arquivo**: `components/QualidadeAgua/GraficosAnalise.tsx`.
- **Novo Hook**: `hooks/useGraficosAnaliseTelaQualidadeAgua.ts`.
- **Descrição**: Extração da pesada lógica de processamento de dados, cruzamento com legislações e cálculos de limites para um hook customizado.
- **Nomenclatura**: Tradução completa de funções e variáveis (ex: `parseValor` -> `converterParaNumero`).
- **Benefício**: Redução drástica da complexidade do componente visual, que agora foca apenas na renderização do Carrossel e dos Gráficos.

----------------------------------------------

### 13. Modularização dos Hooks (Qualidade da Água)
- **Arquivo**: `components/QualidadeAgua/index.tsx`.
- **Novos Hooks Especializados**: 
    1. `hooks/useFiltrosEParametrosQualidadeAgua.ts`: Cuida apenas de dropdowns e estados dos filtros.
    2. `hooks/useExecucaoAnaliseQualidadeAgua.ts`: Focado na execução pesada de APIs e IA.
    3. `hooks/useGerenciadorRelatorioQualidadeAgua.ts`: O orquestrador que une as ferramentas acima.
    4. `hooks/useExportacaoRelatorioQualidadeAgua.ts`: Cuida de PDF e Word.
- **Descrição**: Substituição do antigo "God Hook" por uma arquitetura modular baseada em SRP (Responsabilidade Única).
- **Nomenclatura**: Nomes extremamente descritivos para cada ferramenta.
- **Benefício**: Código muito mais fácil de manter, testar e entender. O `index.tsx` agora usa apenas o "Gerenciador".

----------------------------------------------
### 14. Modularização dos Hooks (Nível Estático)
- **Arquivo**: `components/GraficoPiezometro/index.tsx`.
- **Novos Hooks Especializados**: 
    1. `hooks/useFiltrosNivelEstatico.ts`: Gerencia dropdowns e categorias de piezômetros.
    2. `hooks/useConfiguracaoGraficoNivelEstatico.ts`: Encapsula a lógica visual do Chart.js.
    3. `hooks/useGerenciadorNivelEstatico.ts`: Orquestrador principal das buscas e IA.
- **Descrição**: O antigo `usePiezometroData.ts` (~700 linhas) foi eliminado e substituído por uma arquitetura modular baseada em SRP.
- **Nomenclatura**: Nomes traduzidos para o português e variáveis padronizadas (ex: `filtros`, `aoBuscar`, `dadosGrafico`).
- **Benefício**: Separação clara entre lógica de UI, lógica de visualização e lógica de negócio/IA.

----------------------------------------------